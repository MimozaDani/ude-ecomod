<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Jelena H. Pantel" />


<title>Week 11, Lecture 5.1 Exercise</title>

<script src="site_libs/header-attrs-2.19/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Ecological Modelling</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Syllabus
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./schedule.html">Course schedule</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    About me
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./aboutme.html">Learn more about me</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Projects
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Project 1</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="./project1.html">Guidelines</a>
        </li>
        <li>
          <a href="./Pantel_cheat_LV.html">Example cheat sheet</a>
        </li>
        <li class="dropdown-submenu">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Resources</a>
          <ul class="dropdown-menu" role="menu">
            <li>
              <a href="./stage.html">Stage structured models</a>
            </li>
            <li>
              <a href="./metapop.html">Metapopulation model</a>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li>
      <a href="./project2.html">Project 2</a>
    </li>
  </ul>
</li>
<li>
  <a href="./contact.html">Contact</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/githubusername/mywebsite">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Week 11, Lecture 5.1 Exercise</h1>
<h4 class="author">Jelena H. Pantel</h4>
<h4 class="date">2023-01-19 08:38:46</h4>

</div>


<div id="exercise-1.-fitting-data-to-a-model-linear-regression"
class="section level2">
<h2>Exercise 1. Fitting data to a model: linear regression</h2>
<div id="a.-overview" class="section level5">
<h5>A. Overview</h5>
<p>I indicated that even a linear regression is actually proposing a
model - that a response variable <em>y</em> is driven by a driving
variable <em>x</em>, and that this relationship is linear. For example,
I might hypothesize that newborn baby weight (kg) is driven by the
length of gestation (weeks). As a researcher, I collect data to test
this hypothesize and see how well a linear model does describe the
relationship, and I estimate the <em>parameters</em> in the linear
model.</p>
<p>The data looks like this:</p>
<table>
<thead>
<tr class="header">
<th align="left">gestation</th>
<th align="left">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">30</td>
<td align="left">1.6</td>
</tr>
<tr class="even">
<td align="left">32</td>
<td align="left">1.7</td>
</tr>
<tr class="odd">
<td align="left">34</td>
<td align="left">2.5</td>
</tr>
<tr class="even">
<td align="left">36</td>
<td align="left">2.8</td>
</tr>
<tr class="odd">
<td align="left">38</td>
<td align="left">3.2</td>
</tr>
<tr class="even">
<td align="left">40</td>
<td align="left">3.5</td>
</tr>
</tbody>
</table>
<p>The linear model looks like this:</p>
<p><span class="math display">\[y = m(x) + b\]</span> <span
class="math display">\[ weight = m(gestation period) + b \]</span> This
model has variables <em>y</em> and <em>x</em>, and parameters <em>m</em>
(the slope) and <em>b</em> (the <em>y</em>-intercept). Our goal is to
<strong>fit the data to the model</strong>, and estimate the model
parameters <em>m</em> and <em>b</em> that are most consistent with the
data. You will learn how to do this in an Introduction to Statistics
with R class - here I am using it to show you how to fit data to a model
in the most basic case. This knowledge will come in handy later when we
have more complex data and models. Please open a new R script and
complete the following exercises (in some instances I provide the full
code and you just need to type it into your R script. In other instances
you will generate the code during class). Save your code
periodically!</p>
</div>
<div id="step-1-enter-the-data-into-r" class="section level5">
<h5>Step 1: Enter the data into R</h5>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>baby <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">32</span>, <span class="dv">34</span>, <span class="dv">36</span>, <span class="dv">38</span>, <span class="dv">40</span>), <span class="fu">c</span>(<span class="fl">1.6</span>,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.7</span>, <span class="fl">2.5</span>, <span class="fl">2.8</span>, <span class="fl">3.2</span>, <span class="fl">3.5</span>)), <span class="at">nrow =</span> <span class="dv">6</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="cn">NULL</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;gestation&quot;</span>, <span class="st">&quot;weight&quot;</span>)))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>baby <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(baby)</span></code></pre></div>
</div>
<div
id="step-2-create-a-plot-with-gestation-period-on-the-x-axis-and-weight-on-the-y-axis"
class="section level5">
<h5>Step 2: Create a plot with gestation period on the x-axis and weight
on the y-axis</h5>
<p><img src="L5.1_exercise_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div
id="step-3-use-least-squares-regression-to-fit-data-to-linear-model-estimate-the-most-likely-parameter-values-given-the-data"
class="section level5">
<h5>Step 3: Use least-squares regression to fit data to linear model,
estimate the most likely parameter values given the data</h5>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">lm</span>(weight <span class="sc">~</span> gestation, <span class="at">data =</span> baby)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine model</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = weight ~ gestation, data = baby)
## 
## Residuals:
##        1        2        3        4        5        6 
##  0.07143 -0.23714  0.15429  0.04571  0.03714 -0.07143 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -4.60000    0.64335   -7.15 0.002024 ** 
## gestation    0.20429    0.01829   11.17 0.000366 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1531 on 4 degrees of freedom
## Multiple R-squared:  0.9689, Adjusted R-squared:  0.9611 
## F-statistic: 124.7 on 1 and 4 DF,  p-value: 0.0003661</code></pre>
<p>Based on this, what are the most likely estimates for the slope and
y-intercept?</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>model</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = weight ~ gestation, data = baby)
## 
## Coefficients:
## (Intercept)    gestation  
##     -4.6000       0.2043</code></pre>
<p>And what is the value of the residual sum of squares (RSS, sum of
squared deviations from observed to model-predicted data)?</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deviance</span>(model)</span></code></pre></div>
<pre><code>## [1] 0.09371429</code></pre>
<p>We can place the model-estimated line onto the scatterplot of the
observed data to see the model-predicted values of weight for each
gestation age <em>according to our model</em>. We use the command
<code>abline(model)</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(baby, <span class="at">main =</span> <span class="st">&quot;Estimated baby weights during pregnancy&quot;</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;Gestation period (weeks)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Weight (kg)&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(model)</span></code></pre></div>
<p><img src="L5.1_exercise_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div
id="step-4-repeat-use-least-squares-regression-to-fit-data-to-linear-model-estimate-the-most-likely-parameter-values-given-the-data"
class="section level5">
<h5>Step 4: Repeat: use least-squares regression to fit data to linear
model, estimate the most likely parameter values given the data</h5>
<p>To make sure this is clear, let’s look at the sum of squared
residuals for some data that is poor fit to a linear model. Enter the
following data into R, and run a linear regression using the
<code>lm</code> command, then calculate the <em>residual sum of squares
(RSS)</em>:</p>
<table>
<thead>
<tr class="header">
<th align="center">gestation</th>
<th align="center">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">30</td>
<td align="center">1.4</td>
</tr>
<tr class="even">
<td align="center">32</td>
<td align="center">2.4</td>
</tr>
<tr class="odd">
<td align="center">34</td>
<td align="center">2.4</td>
</tr>
<tr class="even">
<td align="center">36</td>
<td align="center">4.7</td>
</tr>
<tr class="odd">
<td align="center">38</td>
<td align="center">3.8</td>
</tr>
<tr class="even">
<td align="center">40</td>
<td align="center">3.2</td>
</tr>
</tbody>
</table>
<p><img src="L5.1_exercise_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>I got a value of sum of squared residuals equal to 3.4161905,
indicating that the best-fit line (obtained by minimizing the RSS) is
not as good a fit to this data as the dataset above.</p>
<p>I hope it makes sense now how we fit data to our hypothesized model
and estimate the parameters of the model most likely to have produced
our observed data.</p>
</div>
</div>
<div
id="exercise-2.-fitting-data-to-a-model-nonlinear-least-squares-nls"
class="section level2">
<h2>Exercise 2. Fitting data to a model: nonlinear least squares
(nls)</h2>
<div id="a.-overview-1" class="section level5">
<h5>A. Overview</h5>
<p>We can use the same perspective - fitting data to a model by
minimizing the RSS - to study non-linear models. This presentation is
very straight-forward, but I will be transparent that non-linear least
squares isn’t always easy (I chose data that was relatively easy to
fit). You would take more coursework to really be ready to apply this to
more nonlinear models (thought it certainly is done, usually for
single-species growth or feeding curves).</p>
<p>Here, we will look at how organisms absorb and utilize nutrients - a
nutrient-response curve (perhaps useful for studying phtyoplankton
nutrient uptake). In this instance, we still have a response variable
<em>y</em> and a causal variable <em>x</em>, but the relationship
between <em>x</em> and <em>y</em> is nonlinear. It has been observed
that many nutrient-response curves reach an asymptote, where organisms
become saturated, and no longer increase their absorption no matter how
many more nutrients are available. The shape of one kind of useful
saturation curve is described by a <em>Michaelis-Menten</em> model.</p>
<p>The general form of this is:</p>
<p><span class="math display">\[ Y = \frac{aX}{b + X} \]</span></p>
<p>In our phytoplankon example, let’s say that <em>Y</em> is the cell
length (in <span class="math inline">\(\mu m\)</span>) and <em>X</em> is
the phosphorus concentration (in <span class="math inline">\(\mu g /
l\)</span>). The model parameters are <em>a</em>, the upper asymptote
(for $ X $), and <em>b</em>, the the <em>X</em> value giving a response
equal to <em>a</em>/2.</p>
<p>The data looks like this:</p>
<table>
<thead>
<tr class="header">
<th align="right">Y</th>
<th align="right">X</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">12.73644</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">13.66411</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">14.10844</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="right">14.43210</td>
<td align="right">22</td>
</tr>
<tr class="odd">
<td align="right">14.77975</td>
<td align="right">28</td>
</tr>
<tr class="even">
<td align="right">14.86073</td>
<td align="right">39</td>
</tr>
<tr class="odd">
<td align="right">14.78124</td>
<td align="right">46</td>
</tr>
<tr class="even">
<td align="right">14.90793</td>
<td align="right">200</td>
</tr>
</tbody>
</table>
<p><img src="L5.1_exercise_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div
id="step-2-use-nonlinear-least-squares-to-fit-data-to-model-estimate-the-most-likely-parameter-values-given-the-data"
class="section level5">
<h5>Step 2: Use nonlinear least-squares to fit data to model, estimate
the most likely parameter values given the data</h5>
<p>Non-linear least squares is included in base R and can be fit to data
using the <code>nls</code> command. Use <code>?nls</code> to check the
syntax needed to get this command to work: You’ll need to specify the
model formula, the data, and often starting values - these are beginning
options for estimates for the nls estimator. nls has a difficult job,
which is guessing the combination of parameters that are the best fit
for the data - give it a hand by making reasonable suggestions for
beginning values of model parameters that need to ne estimated.</p>
<p>Note that r is also pre-supplied with <em>some</em> model formulas,
including a Michaelis-Menten curve, that pre-chooses starting values for
you. If you’re lucky eough to be fitting a model already included in R’s
formulas, the job will be easier. You can find the self-starting models
included with R by checking <code>?selfStart</code>, these include:
<code>SSasymp, SSasympOff, SSasympOrig, SSbiexp, SSfol, SSfpl, SSgompertz, SSlogis, SSmicmen, SSweibull</code>.</p>
<p>To fit the data to the Michaelis-Menten model using the self-start
formula <code>SSmicmen</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>model.nls <span class="ot">&lt;-</span> <span class="fu">nls</span>(Y <span class="sc">~</span> <span class="fu">SSmicmen</span>(X, a, b))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model.nls)</span></code></pre></div>
<pre><code>## 
## Formula: Y ~ SSmicmen(X, a, b)
## 
## Parameters:
##   Estimate Std. Error t value Pr(&gt;|t|)    
## a 14.97166    0.06057  247.17 2.96e-13 ***
## b  0.50207    0.03345   15.01 5.51e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1196 on 6 degrees of freedom
## 
## Number of iterations to convergence: 0 
## Achieved convergence tolerance: 3.043e-06</code></pre>
<p>Let’s plot the data and fitted curve: full disclosure, this is the
function <code>plot_nls</code> from the R package <code>nlshelper</code>
- copy and</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>newX <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">200</span>,<span class="at">by=</span>.<span class="dv">1</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(newX) <span class="ot">&lt;-</span> <span class="st">&quot;X&quot;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model.nls, newX)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X,Y, <span class="at">main =</span> <span class="st">&quot;Michaelis-Menten nutrient uptake&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;cell length (micrometers)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;P (micrograms / liter)&quot;</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(newX<span class="sc">$</span>X, pred, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="L5.1_exercise_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div
id="step-3-use-nls-to-analyze-data-for-2-competing-daphnia-over-9-weeks-in-a-mesocosm"
class="section level5">
<h5>Step 3: Use nls to analyze data for 2 competing <em>Daphnia</em>
over 9 weeks in a mesocosm</h5>
<p>I set up an experiment in 2020, where I placed <em>Daphnia pulex</em>
and <em>Daphnia magna</em> in a 300-liter container, added water,
nutrients, and phytoplankton. I let the <em>Daphnia</em> grow for 9
weeks, then fit the data to a Lotka-Volterra competition model, to
estimate growth rates and interaction coefficients. I used nls for this,
so let’s take a look at the data and the fit of that curve.</p>
<table>
<thead>
<tr class="header">
<th align="center">gestation</th>
<th align="center">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">30</td>
<td align="center">1.4</td>
</tr>
<tr class="even">
<td align="center">32</td>
<td align="center">2.4</td>
</tr>
<tr class="odd">
<td align="center">34</td>
<td align="center">2.4</td>
</tr>
<tr class="even">
<td align="center">36</td>
<td align="center">4.7</td>
</tr>
<tr class="odd">
<td align="center">38</td>
<td align="center">3.8</td>
</tr>
<tr class="even">
<td align="center">40</td>
<td align="center">3.2</td>
</tr>
</tbody>
</table>
<p><img src="L5.1_exercise_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
